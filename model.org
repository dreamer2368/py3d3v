#+TITLE:  3d3v Electrostatic PIC Code
#+AUTHOR: Scott High
#+LATEX_HEADER: \newcommand{\pd}[2]{\frac{\partial #1}{ \partial #2}}

* Model Definition

** General description
Approximating a 3 dimensional plasma using a finite number of
negatively charged electrons and positively charge ions.

- Particle dynamics are simulated by solving
  \[ F = q(E+v \times B) \]
  where
  \[ E = -\nabla \phi \]
  and
  \[ \nabla^2 \phi = -\frac{\rho}{\epsilon_0} \]
  - $\phi$ is approximated from the mesh charge density using second order
    centered finite differences
  - $E$ is approximated from $\phi$ using second order centered finite
    differences
- The time integrator is Leap-Frog
  - $v$ is advanced using the Boris Method
  - $x$ is advanced in the obvious way using $v$
  - See below for details
- Particle charges are interpolated to a uniform mesh to approximate
  $\rho$ using the cloud in cell (CIC) method. This is equivalent to
  linear interpolation.
- The magnetic field is uniform in the $z$ direction, and is held
  constant at $B_0$.
- Particles are free to move in $x, y, z$ and have velocity components
  $v_x, v_y, v_z$

** Algorithm

1) Weight charges $q_i$ to the uniform mesh to get charge density $\rho$
   - Cloud in cell (CIC)
2) Solve $\nabla^2 \phi(t) = -\frac{\rho}{\epsilon_0}$ for $\phi(t)$
   - Using FFT
3) Solve $E(t) = -\nabla \phi(t)$ for $E_x, E_y, E_z$
4) Interpolate $E_x, E_y, E_z$ to particle positions
5) Advance $v(t-\Delta t/2) \to v(t+\Delta t/2)$ using $E(t)$
6) Advance $x(t) \to x(t+\Delta t)$ using $v(t+\Delta t/2)$

*** Time integration details

**** Boris method for advancing $v$
\begin{equation}
v^{-} = v_{t-\Delta t/2} + \frac{qE}{m} \frac{\Delta t}{2}
\end{equation}
\begin{equation}
\frac{v^+-v^-}{\Delta t} = \frac{q}{2m}(v^+ + v^-)\times B
\end{equation}
\begin{equation}
v_{t+\Delta t/2} = v^+ + \frac{qE}{m}\frac{\Delta t}{2}
\end{equation}

**** Advancing $x$
\[ x(t+\Delta t) = x(t) + v(t+\Delta t/2) \Delta t \]

* Model Validation

** Landau Oscillations
Landau oscillations are simple harmonic density waves that form in
cold plasmas in response to small perturbations in the initial charge
density (with $B_0=0$). For simplicity we create oscillations only in
the $x$ direction. To approximate the conditions in a cold plasma, the
simulation volume is filled with a large number of particles with
charge chosen such that particles in the $y$-$z$ plane approximate
sheet charges with charge density $q$.

The particle displacements are expected to follow
\[ \ddot{\delta x} = - \omega_p^2 \delta x \]
which is simple harmonic motion with period
$\omega_p=(\frac{nq^2}{m \epsilon_0})^{1/2}$.

*** Initial Conditions
- Position perturbation: $x = x_0 + A \cos(k x_0)$
  - Corresponds to a $\sin$ perturbation in the initial density at the
    same mode
- Expected density: $\rho(x, t) \propto \sin(kx)\cos(\omega t)$

*** Dispersion relation
- For a cold plasma at rest
  \[ \omega(\bold{k}) = \omega_p \]
- The numerical dispersion relation is
  \[ \omega(k) = \omega_p \cos\left(\frac{k \Delta x}{2}\right) \]

*** Derivation
We know that Maxwell's equations are satisfied by wave solutions of
the form $E = \hat{E} e^{i(k x-\omega t)}$. Because ions are
considerably more massive than electrons, we hold them fixed. Then, we
can write electron density $n$ and velocity $v$ as
\[ n = n_0 + \hat{n} e^{i(k x-\omega t)} \]
\[ v = \hat{v} e^{i(k x-\omega t)} \]
Apply the continuity equation
\[ \pd{n}{t} + \pd{(n v)}{x} = 0  \]
to get
\[ -i \omega \hat{n} + ik n_0 \hat{v} = 0 \]
\[ \implies \hat{v} = \frac{\omega \hat{n}}{k n_0} \]
We can write the Lorentz force as
\[ m \dot{v} = -q \frac{d \phi}{d x}  \]
\[ \implies -i \omega \hat{n} + i k n_0 \hat{v} = 0  \]
where the potential $\phi$ is given by
\[ -k^2 \phi = \frac{q}{\epsilon_0} \hat{n} \]
We can combine the above equations with
$\omega_p=\left(\frac{n_0 q^2}{m \epsilon_0}\right)$
to get
\[ \omega = \omega_p \]

*** Numerical Results
- Initial charge positions are equispaced in the domain
- $\omega$ vs $k$ for fixed $dx$ (with constant $L$)
  
  [[file:py3d3v/wk_fixed_dx.png]]
  - ppc = average particles per cell per dimension before pertubation
    - Total average particles per cell will be ppc$^3$
  - Number of grid points = $64^3$
  - $L_x = L_y = L_z = 2\pi$
  - $dx = dy = dz = \frac{64}{2\pi}$
  - Number of charges = $(\text{ppc}\times 64)^3$
  - $k = \text{mode}\cdot \frac{2\pi}{L}$
- Choosing parameters
  - With ppc=2 the experimental numerical dispersion approaches the
    expected numerical dispersion $\omega(k) = \omega_p\cos(\frac{k
    dx}{2})$
- Measuring $\omega$
  - If the initial density is pertubed in the $k^{th}$ fourier mode,
    the density is expected to follow $\rho(k, t) \propto \cos(\omega
    t)$, which is generally complex.  Then we can use the fact that
    $\rho(k, t) \rho^*(k, t) \propto \cos^2(\omega t) =
    \frac{1}{2}(\cos(2\omega t)-1)$ is real to compute $\omega$. The
    first 10 time steps are averaged to produce the estimated
    $\omega$. The results produced using this method are consistent
    with measuring $\omega$ directly from particle displacements and
    are simpler to calculate.
- I am currently investigating the high error when ppc<1.
  
** Plasma Sheath
When a plasma comes into contact with a metal surface, the faster
moving electrons deposit charge on the surface faster than the slower
moving ions. This leads to a net negative charge on the surface, which
is balanced out by a net positive charge a short distance from the
wall. The resulting region of positive charge is called the plasma
sheath.
